# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

XBoing is a classic X11 breakout/blockout game (1993-1996, Justin C. Kibell) modernized for current Linux systems. It uses pure Xlib (no Motif/Xt) with the XPM library for pixmap graphics.

## Build Commands

```bash
make          # Build (generates audio.c symlink, version.c, compiles all, links)
make clean    # Remove objects, binary, and generated files
./xboing      # Run the game (must run from repo root for asset paths)
./xboing -setup  # Print configuration/path info
./xboing -help   # Show command-line options
```

**Dependencies:** `libxpm-dev`, `libx11-dev`, GCC. Libraries linked: `-lXpm -lX11 -lm`.

## Architecture

**State machine game loop** in `main.c`: 16 modes (intro, game, pause, demo, edit, highscore, etc.) driven by an X11 event loop with frame timing. Mode transitions are handled via a central `gameMode` variable.

**Key modules (each a .c/.h pair):**

| Module | Role |
|--------|------|
| `main.c` | Event loop, state machine, input dispatch |
| `init.c` | X11 display/window setup, colormap, pixmap loading |
| `ball.c` | Ball physics, collision detection (up to 5 simultaneous balls) |
| `blocks.c` | Block grid (18 rows x 9 cols), 30 block types, collision/explosion |
| `paddle.c` | Paddle control (keyboard/mouse), 3 sizes |
| `level.c` | Level loading from `levels/*.data` files |
| `stage.c` | Window management (play, score, level, message sub-windows) |
| `highscore.c` | Score file I/O with file locking |
| `editor.c` | Built-in level editor |
| `audio.c` | Symlink to platform-specific driver (default: `audio/LINUXaudio.c`) |

**Build-generated files:** `audio.c` is a symlink to `audio/LINUXaudio.c`. `version.c` is generated by `version.sh`.

**Assets:** XPM pixmaps in `bitmaps/`, level data in `levels/`, `.au` sounds in `sounds/`.

**Compile defines** control paths at build time: `HIGH_SCORE_FILE`, `LEVEL_INSTALL_DIR`, `SOUNDS_DIR`, `AUDIO_FILE`. These default to relative paths (game runs from repo root). Users can override at runtime via env vars: `XBOING_SCORE_FILE`, `XBOING_LEVELS_DIR`, `XBOING_SOUND_DIR`.

## Code Conventions

- C89/ANSI C with dual prototype support controlled by `NeedFunctionPrototypes`
- Modules use static variables for persistent state; globals declared `extern` in headers
- Graphics via XPM pixmaps (no direct drawing); double-buffered with backing store
- Region-based collision detection for blocks
- Frame-based animation with timing controls
- Audio is pluggable: swap the `audio.c` symlink target for different platforms (Linux, Sun, HP, SGI, NCD, RPLAY, or `NOaudio.c` for silent)
